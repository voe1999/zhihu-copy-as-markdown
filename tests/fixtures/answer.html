<div class="QuestionAnswer-content" tabindex="0">
    <div>
        <div class="ContentItem AnswerItem"
            data-zop="{&quot;authorName&quot;:&quot;hez2010&quot;,&quot;itemId&quot;:&quot;3621840220&quot;,&quot;title&quot;:&quot;为什么c#能做大型游戏，而java不适合，c#跟java不是很相似吗？&quot;,&quot;type&quot;:&quot;answer&quot;}"
            name="3621840220" itemprop="mainEntityOfPage" itemtype="http://schema.org/Answer" itemscope=""
            data-za-detail-view-path-module="AnswerItem"
            data-za-extra-module="{&quot;card&quot;:{&quot;has_image&quot;:false,&quot;has_video&quot;:false,&quot;content&quot;:{&quot;type&quot;:&quot;Answer&quot;,&quot;token&quot;:&quot;3621840220&quot;,&quot;upvote_num&quot;:430,&quot;comment_num&quot;:67,&quot;publish_timestamp&quot;:null,&quot;parent_token&quot;:&quot;653663815&quot;,&quot;author_member_hash_id&quot;:&quot;17aae6f1ba0270c70043032f5d6a6ce4&quot;}}}">
            <div class="ContentItem-meta">
                <div class="AuthorInfo AnswerItem-authorInfo AnswerItem-authorInfo--related" itemprop="author"
                    itemscope="" itemtype="http://schema.org/Person" data-block-listener-added="true">
                    <div class="AuthorInfo">
                        <meta itemprop="name" content="hez2010">
                        <meta itemprop="image"
                            content="https://picx.zhimg.com/v2-a0629e730dffd9a743164e8fc0b77a10_l.jpg?source=2c26e567">
                        <meta itemprop="url" content="https://www.zhihu.com/people/hez2010">
                        <meta itemprop="zhihu:followerCount" content="25898"><span
                            class="UserLink AuthorInfo-avatarWrapper">
                            <div class="css-1gomreu"><a href="//www.zhihu.com/people/hez2010" target="_blank"
                                    class="UserLink-link" data-za-detail-view-element_name="User"
                                    data-block-listener-added="true"><img class="Avatar AuthorInfo-avatar css-1hx3fyn"
                                        src="https://picx.zhimg.com/v2-a0629e730dffd9a743164e8fc0b77a10_l.jpg?source=2c26e567"
                                        srcset="https://picx.zhimg.com/v2-a0629e730dffd9a743164e8fc0b77a10_l.jpg?source=2c26e567 2x"
                                        alt="hez2010"></a></div>
                        </span>
                        <div class="AuthorInfo-content">
                            <div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name">
                                    <div class="css-1gomreu"><a href="//www.zhihu.com/people/hez2010" target="_blank"
                                            class="UserLink-link" data-za-detail-view-element_name="User"
                                            data-block-listener-added="true">hez2010</a></div><a
                                        href="https://www.zhihu.com/question/48510028" target="_blank"
                                        class="css-4gq0sj" aria-label="东京大学 计算机科学硕士" data-tooltip="东京大学 计算机科学硕士"><span
                                            style="display: inline-flex; align-items: center;">​<svg width="18"
                                                height="18" fill="none" viewBox="0 0 24 24"
                                                class="ZDI ZDI--BadgeCertNewStrokeLightFill24 css-1ldqog6">
                                                <path fill="#fff"
                                                    d="M12 2c-2.02.05-1.86 1.2-3.38 1.83-1.48.61-2.33-.26-3.69 1.1-1.39 1.47-.46 2.17-1.1 3.69C3.2 10.14 2.05 9.98 2 12c.05 2.02 1.2 1.86 1.83 3.38.63 1.52-.3 2.22 1.1 3.69 1.36 1.35 2.21.49 3.69 1.1 1.52.63 1.36 1.78 3.38 1.83 2.02-.05 1.86-1.2 3.38-1.83 1.48-.61 2.33.26 3.69-1.1 1.39-1.47.46-2.16 1.1-3.69.63-1.52 1.78-1.36 1.83-3.38-.05-2.02-1.2-1.86-1.83-3.38-.63-1.52.3-2.22-1.1-3.69-1.36-1.35-2.21-.49-3.69-1.1C13.86 3.2 14.02 2.05 12 2Z"
                                                    style="fill: rgb(255, 255, 255); fill-opacity: 1;"></path>
                                                <path fill="url(#id-106203557-a)" fill-rule="evenodd"
                                                    d="M3 12c0 1.449 1.035 1.251 1.755 2.997s-.144 2.34.882 3.366c1.026 1.026 1.62.153 3.366.882C10.749 19.965 10.551 21 12 21c1.449 0 1.251-1.035 2.997-1.755s2.34.144 3.366-.882c1.026-1.026.153-1.62.882-3.366C19.965 13.251 21 13.44 21 12c0-1.449-1.035-1.251-1.755-2.997s.144-2.34-.882-3.366c-1.026-1.026-1.62-.153-3.366-.882C13.251 4.035 13.449 3 12 3c-1.449 0-1.251 1.035-2.997 1.755s-2.34-.144-3.366.882c-1.026 1.026-.153 1.62-.882 3.366C4.035 10.749 3 10.551 3 12Z"
                                                    clip-rule="evenodd"></path>
                                                <path fill="#fff" fill-rule="evenodd"
                                                    d="m10.003 15.355-2.37-2.699s-.413-.634.217-1.226c.63-.591 1.195-.197 1.195-.197l1.758 1.92 4.226-4.439s.597-.313 1.17.178c.572.49.243 1.244.243 1.244s-3.12 3.472-4.839 5.204c-.881.837-1.6.015-1.6.015Z"
                                                    clip-rule="evenodd"
                                                    style="fill: rgb(255, 255, 255); fill-opacity: 1;"></path>
                                                <defs>
                                                    <linearGradient id="id-106203557-a" x1="5.7" x2="15.6" y1="5.7"
                                                        y2="19.2" gradientUnits="userSpaceOnUse">
                                                        <stop stop-color="#47D3FF"
                                                            style="stop-color: rgb(71, 211, 255); stop-opacity: 1;">
                                                        </stop>
                                                        <stop offset="1" stop-color="#4A7DFF"></stop>
                                                    </linearGradient>
                                                </defs>
                                            </svg></span></a><span rel="noopener noreferrer" class="css-2dtzk2">​<img
                                            src="https://picx.zhimg.com/v2-4812630bc27d642f7cafcd6cdeca3d7a.jpg?source=88ceefae"
                                            alt="" class="css-1m3x3v9"></span><a
                                        href="https://www.zhihu.com/kvip/purchase" rel="noopener noreferrer"
                                        class="css-2dtzk2">​<img
                                            src="https://pic1.zhimg.com/v2-57fe7feb4813331d5eca02ef731e12c9.jpg?source=88ceefae"
                                            alt="知乎知识会员" class="css-1m3x3v9"></a>
                                </span></div>
                            <div class="AuthorInfo-detail">
                                <div class="AuthorInfo-badge">
                                    <div class="ztext AuthorInfo-badgeText css-14ur8a8">东京大学 计算机科学硕士</div>
                                </div>
                            </div>
                        </div>
                    </div><button type="button"
                        class="Button FollowButton css-upmq18 FEfUrdfMIKpQDJDqkjte Button--secondary Button--grey E211w_M7Hzs0GMB7BEyA ZdfrHW7Ef5ZjwFiiBJuS">已关注</button>
                    <div class="css-124ezq8"></div>
                </div>
                <div class="css-9x8rdd">
                    <div class="css-q2wk8b"><a class="css-1l65l8l"
                            href="https://www.zhihu.com/people/3063519967ec9abe8cf4b0f848264496"
                            style="cursor: default;" data-block-listener-added="true"><svg width="20" height="20"
                                viewBox="0 0 24 24" fill="#09408e" class="ZDI ZDI--CrabFill24 css-1tu59u4">
                                <path
                                    d="M7.093 5.48a.75.75 0 0 0-.657-.743 4.641 4.641 0 0 0-3.66 1.117c-.896.784-1.485 1.9-1.485 3.006a3.822 3.822 0 0 0 3.823 3.823c1.467 0 2.628-.653 3.312-1.678.673-1.01.842-2.317.481-3.58a.75.75 0 0 0-.958-.505l-.856.286V5.48ZM18.183 4.753a.75.75 0 0 0-.657.744v1.71l-.846-.282a.75.75 0 0 0-.959.506c-.359 1.257-.19 2.558.48 3.564.68 1.02 1.837 1.67 3.298 1.67a3.807 3.807 0 0 0 3.807-3.806c0-1.102-.586-2.213-1.48-2.993a4.621 4.621 0 0 0-3.643-1.113Z">
                                </path>
                                <path fill-rule="evenodd"
                                    d="M5.848 17.446a.6.6 0 0 1-.544.651l-1.979.178a.6.6 0 0 1-.107-1.195l1.978-.178a.6.6 0 0 1 .652.544ZM5.83 19.432a.6.6 0 0 1-.336.78l-1.444.573a.6.6 0 1 1-.443-1.115l1.444-.574a.6.6 0 0 1 .779.336ZM5.963 15.247a.6.6 0 0 1-.6.6h-1.72a.6.6 0 1 1 0-1.2h1.72a.6.6 0 0 1 .6.6ZM18.765 17.446a.6.6 0 0 0 .544.651l1.979.178a.6.6 0 0 0 .107-1.195l-1.978-.178a.6.6 0 0 0-.652.544ZM18.783 19.432a.6.6 0 0 0 .336.78l1.444.573a.6.6 0 1 0 .443-1.115l-1.444-.574a.6.6 0 0 0-.779.336ZM18.65 15.247a.6.6 0 0 0 .6.6h1.721a.6.6 0 0 0 0-1.2h-1.72a.6.6 0 0 0-.6.6Z"
                                    clip-rule="evenodd"></path>
                                <path
                                    d="M18.25 18.405c0 1.517-1.238 2.457-2.756 2.457H9.006c-1.517 0-2.756-.94-2.756-2.457 0-2.14 1.381-3.991 3.385-4.866a1 1 0 1 1 1.558-.456 6.688 6.688 0 0 1 2.114 0 1 1 0 1 1 1.558.455c2.004.876 3.385 2.726 3.385 4.867Z">
                                </path>
                            </svg>
                            <div class="css-4rl99m">
                                <div class="css-140fcia">谢邀 @Rico</div>
                            </div>
                        </a></div>
                </div>
                <div>
                    <div class="css-dvccr2">
                        <div class="css-1lr85n">nscript 等 430 人赞同了该回答</div><svg width="14px" height="14px"
                            viewBox="0 0 16 16" class="ZDI ZDI--ArrowRight16 css-z4ujak" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M6.252 2.328a.75.75 0 0 1 1.04.213l3.334 5.05a.75.75 0 0 1 0 .826L7.292 13.46a.75.75 0 0 1-1.251-.828L9.1 8.004 6.04 3.367a.75.75 0 0 1 .212-1.039Z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div><span class="css-z4ujak"></span>
            </div>
            <meta itemprop="image">
            <meta itemprop="upvoteCount" content="430">
            <meta itemprop="url" content="https://www.zhihu.com/question/653663815/answer/3621840220">
            <meta itemprop="dateCreated" content="2024-09-10T16:12:18.000Z">
            <meta itemprop="dateModified" content="2024-09-21T07:05:16.000Z">
            <meta itemprop="commentCount" content="67">
            <div class="RichContent RichContent--unescapable"><span>
                    <div class="RichContent-inner">
                        <div class="css-376mun"><span id="content"><span
                                    class="RichText ztext CopyrightRichText-richText css-1mev9j9"
                                    options="[object Object]" itemprop="text">
                                    <div class="zhihucopier-button"><button type="button" class="zhihucopier-button"
                                            style="background-color: rgba(85, 85, 85, 0.9); width: 120px; right: 0px; top: -2em; height: 2em; margin: 0px 0.2em 1em; outline: none; cursor: pointer; font-size: 0.8em; border-radius: 1em 0px 0px 1em; z-index: 999; color: white; padding-left: 0.4em;">下载Markdown</button><button
                                            type="button" class="zhihucopier-button"
                                            style="background-color: rgba(85, 85, 85, 0.9); width: 100px; right: 0px; top: -2em; height: 2em; margin: 0px 0.2em 1em; outline: none; cursor: pointer; font-size: 0.8em; border-radius: 0px 1em 1em 0px; z-index: 999; color: white; padding-right: 0.4em;">下载为JSON</button>
                                    </div>
                                    <p data-first-child="" data-pid="wdFuwrME">就说个编写 3D 游戏里最常见的场景吧。</p>
                                    <p data-pid="fxfRUCgF">现在我想要渲染一个 3D 模型，需要将组成模型的面传递给游戏引擎，然后引擎会去调用 <span><a
                                                class="RichContent-EntityWord css-b7erz1" data-za-not-track-link="true"
                                                data-paste-text="true"
                                                href="https://zhida.zhihu.com/search?content_id=688585911&amp;content_type=Answer&amp;match_order=1&amp;q=DirectX&amp;zhida_source=entity"
                                                target="_blank">DirectX<svg width="10px" height="10px"
                                                    viewBox="0 0 16 16" class="ZDI ZDI--FourPointedStar16 css-1dvsrp"
                                                    fill="currentColor">
                                                    <path
                                                        d="m5.068 9.267-3.08-.77a.512.512 0 0 1 0-.994l3.08-.77a2.289 2.289 0 0 0 1.665-1.665l.77-3.08a.512.512 0 0 1 .994 0l.77 3.08c.205.82.845 1.46 1.665 1.665l3.08.77a.512.512 0 0 1 0 .994l-3.08.77a2.29 2.29 0 0 0-1.665 1.665l-.77 3.08a.512.512 0 0 1-.994 0l-.77-3.08a2.289 2.289 0 0 0-1.665-1.665Z">
                                                    </path>
                                                </svg></a></span>/<span><a class="RichContent-EntityWord css-b7erz1"
                                                data-za-not-track-link="true" data-paste-text="true"
                                                href="https://zhida.zhihu.com/search?content_id=688585911&amp;content_type=Answer&amp;match_order=1&amp;q=Vulkan&amp;zhida_source=entity"
                                                target="_blank">Vulkan<svg width="10px" height="10px"
                                                    viewBox="0 0 16 16" class="ZDI ZDI--FourPointedStar16 css-1dvsrp"
                                                    fill="currentColor">
                                                    <path
                                                        d="m5.068 9.267-3.08-.77a.512.512 0 0 1 0-.994l3.08-.77a2.289 2.289 0 0 0 1.665-1.665l.77-3.08a.512.512 0 0 1 .994 0l.77 3.08c.205.82.845 1.46 1.665 1.665l3.08.77a.512.512 0 0 1 0 .994l-3.08.77a2.29 2.29 0 0 0-1.665 1.665l-.77 3.08a.512.512 0 0 1-.994 0l-.77-3.08a2.289 2.289 0 0 0-1.665-1.665Z">
                                                    </path>
                                                </svg></a></span>/OpenGL 等等的 API 将我们模型数据提供给 GPU 渲染出来。</p>
                                    <p data-pid="iYsmfn-n">我们都知道 3D 模型的面由三角形组成，而每个三角形都有 3 个顶点，最后一大堆三角形组成了整个模型的表面。</p>
                                    <p data-pid="ICMRFE2O">那这件事情要怎么做呢？最简单的方法：整一个缓冲区把三角形的各顶点的位置存起来，然后调用图形 API 把数据上传到 GPU
                                        就行了。</p>
                                    <p data-pid="yP7O1JTi">那这件事情在 C# 里面怎么做呢？</p>
                                    <p data-pid="EPJ0G2Pc">首先定义顶点类型：</p>
                                    <div class="highlight">
                                        <pre><code class="language-csharp"><span class="na">[StructLayout(LayoutKind.Sequential)]</span>
<span class="n">record</span> <span class="k">struct</span> <span class="nc">Vertex</span><span class="p">(</span><span class="kt">float</span> <span class="n">X</span><span class="p">,</span> <span class="kt">float</span> <span class="n">Y</span><span class="p">,</span> <span class="kt">float</span> <span class="n">Z</span><span class="p">);</span>
</code></pre>
                                    </div>
                                    <p data-pid="f1IE_omV">然后我们整个顶点数组：</p>
                                    <div class="highlight">
                                        <pre><code class="language-csharp"><span class="kt">var</span> <span class="n">vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vertex</span><span class="p">[</span><span class="m">12345</span><span class="p">];</span>
</code></pre>
                                    </div>
                                    <p data-pid="z2Z1uxq3">然后把我们的三角形扔进去之后直接扔给引擎就完事了。</p>
                                    <p data-pid="JzKrGURV">填充的时候简单 for 循环里往 vertices 里塞 Vertex 就行了。</p>
                                    <p data-pid="iAMNeiAr">假设引擎用的 OpenGL，那此时引擎接收到我们的数组后需要调用 <code>glBufferData</code> 来给
                                        VAO 提供顶点数据：</p>
                                    <div class="highlight">
                                        <pre><code class="language-csharp"><span class="k">const</span> <span class="kt">uint</span> <span class="n">GL_ARRAY_BUFFER</span> <span class="p">=</span> <span class="m">0</span><span class="n">x8892</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">uint</span> <span class="n">GL_STATIC_DRAW</span> <span class="p">=</span> <span class="m">0</span><span class="n">x88E4</span><span class="p">;</span>
<span class="k">fixed</span> <span class="p">(</span><span class="n">Vertex</span><span class="p">*</span> <span class="n">p</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">)</span>
    <span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Vertex</span><span class="p">)</span> <span class="p">*</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</code></pre>
                                    </div>
                                    <p data-pid="_8-G4ym1">那 <code>glBufferData</code> 这个函数要怎么在 C# 里定义呢？</p>
                                    <div class="highlight">
                                        <pre><code class="language-csharp"><span class="na">[DllImport("glew32.dll", EntryPoint = "__glewBufferData"), SuppressGCTransition]</span>
<span class="k">static</span> <span class="k">extern</span> <span class="k">void</span> <span class="n">glBufferData</span><span class="p">(</span><span class="kt">uint</span> <span class="n">target</span><span class="p">,</span> <span class="n">nint</span> <span class="n">size</span><span class="p">,</span> <span class="k">void</span><span class="p">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">usage</span><span class="p">);</span>
</code></pre>
                                    </div>
                                    <p data-pid="rb4EZIOP">搞定。</p>
                                    <p data-pid="epXVX1Gl">至此为止我没有用到任何的（除了 OpenGL 本身之外的）库，也没有编写任何的 C# 以外的代码。</p>
                                    <p data-pid="LOFDFTwv">那写法这么简单，性能怎么样呢？我们看看最终调用 <code>glBufferData</code> 的部分 JIT
                                        给我们生成了什么代码：</p>
                                    <div class="highlight">
                                        <pre><code class="language-nasm"><span class="nf">add</span>      <span class="nb">rax</span><span class="p">,</span> <span class="mi">16</span> <span class="c1">; address of vertices + method table (8) + array length (8)</span>
<span class="nf">mov</span>      <span class="nv">r8</span><span class="p">,</span> <span class="nb">rax</span> <span class="c1">; = data of vertices</span>
<span class="nf">mov</span>      <span class="nb">edx</span><span class="p">,</span> <span class="mh">0x242AC</span> <span class="c1">; sizeof(Vertex) * vertices.Length</span>
<span class="nf">mov</span>      <span class="nb">ecx</span><span class="p">,</span> <span class="mh">0x8892</span> <span class="c1">; GL_ARRAY_BUFFER</span>
<span class="nf">mov</span>      <span class="nb">r9d</span><span class="p">,</span> <span class="mh">0x88E4</span> <span class="c1">; GL_STATIC_DRAW</span>
<span class="nf">mov</span>      <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x5B589850</span> <span class="c1">; function pointer of glBufferData</span>
<span class="nf">call</span>     <span class="nb">rax</span> <span class="c1">; call glBufferData</span></code></pre>
                                    </div>
                                    <p data-pid="ObPzKBzS">可以看到，没有任何额外的内存分配和开销，数据直接从指针传出去，压根不需要拷贝，从头到尾的零成本抽象。</p>
                                    <p data-pid="RXeeYCXS">甚至可以说 C# 就是一个可以用 GC 的现代版 C++，这对于需要频繁与 native
                                        进行交互的场景而言最适合不过。更不要提 C# 的 <span><a class="RichContent-EntityWord css-b7erz1"
                                                data-za-not-track-link="true" data-paste-text="true"
                                                href="https://zhida.zhihu.com/search?content_id=688585911&amp;content_type=Answer&amp;match_order=1&amp;q=P%2FInvoke&amp;zhida_source=entity"
                                                target="_blank">P/Invoke<svg width="10px" height="10px"
                                                    viewBox="0 0 16 16" class="ZDI ZDI--FourPointedStar16 css-1dvsrp"
                                                    fill="currentColor">
                                                    <path
                                                        d="m5.068 9.267-3.08-.77a.512.512 0 0 1 0-.994l3.08-.77a2.289 2.289 0 0 0 1.665-1.665l.77-3.08a.512.512 0 0 1 .994 0l.77 3.08c.205.82.845 1.46 1.665 1.665l3.08.77a.512.512 0 0 1 0 .994l-3.08.77a2.29 2.29 0 0 0-1.665 1.665l-.77 3.08a.512.512 0 0 1-.994 0l-.77-3.08a2.289 2.289 0 0 0-1.665-1.665Z">
                                                    </path>
                                                </svg></a></span> 在 <span><a class="RichContent-EntityWord css-b7erz1"
                                                data-za-not-track-link="true" data-paste-text="true"
                                                href="https://zhida.zhihu.com/search?content_id=688585911&amp;content_type=Answer&amp;match_order=1&amp;q=NativeAOT&amp;zhida_source=entity"
                                                target="_blank">NativeAOT<svg width="10px" height="10px"
                                                    viewBox="0 0 16 16" class="ZDI ZDI--FourPointedStar16 css-1dvsrp"
                                                    fill="currentColor">
                                                    <path
                                                        d="m5.068 9.267-3.08-.77a.512.512 0 0 1 0-.994l3.08-.77a2.289 2.289 0 0 0 1.665-1.665l.77-3.08a.512.512 0 0 1 .994 0l.77 3.08c.205.82.845 1.46 1.665 1.665l3.08.77a.512.512 0 0 1 0 .994l-3.08.77a2.29 2.29 0 0 0-1.665 1.665l-.77 3.08a.512.512 0 0 1-.994 0l-.77-3.08a2.289 2.289 0 0 0-1.665-1.665Z">
                                                    </path>
                                                </svg></a></span> 之下支持静态链接，连额外的 dll 都省了。</p>
                                    <p class="ztext-empty-paragraph"><br></p>
                                    <p data-pid="IRzU6S6i">以上东西你用 Java 做一个试试，看看能有多复杂，再看看填充 buffer
                                        的时候能否直接利用定义好的数据结构和类型，再看看能不能做到零拷贝。</p>
                                    <p data-pid="a71Gs3qg" class="ztext-empty-paragraph"><br></p>
                                    <p data-pid="jf4OoT6p">更新：</p>
                                    <p data-pid="2ALxZupZ">鉴于 Java 22 之后有了 <span><a
                                                class="RichContent-EntityWord css-b7erz1" data-za-not-track-link="true"
                                                data-paste-text="true"
                                                href="https://zhida.zhihu.com/search?content_id=688585911&amp;content_type=Answer&amp;match_order=1&amp;q=FFM+API&amp;zhida_source=entity"
                                                target="_blank">FFM API<svg width="10px" height="10px"
                                                    viewBox="0 0 16 16" class="ZDI ZDI--FourPointedStar16 css-1dvsrp"
                                                    fill="currentColor">
                                                    <path
                                                        d="m5.068 9.267-3.08-.77a.512.512 0 0 1 0-.994l3.08-.77a2.289 2.289 0 0 0 1.665-1.665l.77-3.08a.512.512 0 0 1 .994 0l.77 3.08c.205.82.845 1.46 1.665 1.665l3.08.77a.512.512 0 0 1 0 .994l-3.08.77a2.29 2.29 0 0 0-1.665 1.665l-.77 3.08a.512.512 0 0 1-.994 0l-.77-3.08a2.289 2.289 0 0 0-1.665-1.665Z">
                                                    </path>
                                                </svg></a></span>，以上东西虽然做起来很麻烦，但是好歹能写出来了，虽然我不知道他们现在的 FFM API
                                        打算如何支持静态链接，毕竟 Java FFM API 这种运行时定义布局和查找入口点跟静态链接就是天生不兼容的。</p>
                                    <p class="ztext-empty-paragraph"><br></p>
                                    <p data-pid="3D5CbrZz">那我们现在进一步加大难度。</p>
                                    <p data-pid="HzMFbtc1">我们都知道给 GPU 送的数据不一定非得是 <code>float</code> ，还可以是
                                        <code>int</code>、<code>double</code> 等等。那此时在 C# 里面我们只需要把顶点类型改成：</p>
                                    <div class="highlight">
                                        <pre><code class="language-csharp"><span class="na">[StructLayout(LayoutKind.Sequential)]</span>
<span class="n">record</span> <span class="k">struct</span> <span class="nc">Vertex</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="n">Y</span><span class="p">,</span> <span class="n">T</span> <span class="n">Z</span><span class="p">)</span> <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">unmanaged</span><span class="p">;</span>
</code></pre>
                                    </div>
                                    <p data-pid="wQWyx26j">然后调用 <code>glBufferData</code> 那句改成：</p>
                                    <div class="highlight">
                                        <pre><code class="language-csharp"><span class="k">fixed</span> <span class="p">(</span><span class="n">Vertex</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;*</span> <span class="n">p</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">)</span>
    <span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Vertex</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="p">*</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</code></pre>
                                    </div>
                                    <p data-pid="wVOgsFpS">就搞定了。</p>
                                    <p data-pid="dHF_CmNd">由于 .NET 会针对泛型参数给代码进行特化，因此 <code>T</code> 无论是 <code>int</code>
                                        、<code>float</code> 还是 <code>double</code>，甚至是更复杂的类型例如
                                        <code>record struct Foo&lt;U&gt;(Bar A, float B, U C)</code>
                                        都能获得独一无二的代码生成，并且其内存布局也是编译时就确定的，效率也有保证。</p>
                                </span><span id="VirtualCatalogAnchorPoint"></span></span></div>
                    </div>
                </span>
                <div>
                    <div class="ContentItem-time"><a target="_blank"
                            href="//www.zhihu.com/question/653663815/answer/3621840220"><span
                                data-tooltip="发布于 2024-09-11 00:12" aria-label="发布于 2024-09-11 00:12">编辑于 2024-09-21
                                15:05</span></a>・日本</div>
                </div><span></span>
                <div class="ContentItem-actions RichContent-actions"><span><span><button aria-label="赞同 430 "
                                aria-live="polite" type="button" class="Button VoteButton FEfUrdfMIKpQDJDqkjte"><span
                                    style="display: inline-flex; align-items: center;">​<svg width="10" height="10"
                                        viewBox="0 0 24 24" class="Zi Zi--TriangleUp VoteButton-TriangleUp"
                                        fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023Z"
                                            clip-rule="evenodd"></path>
                                    </svg></span>赞同 430</button></span><button aria-label="反对" aria-live="polite"
                            type="button" class="Button VoteButton VoteButton--down FEfUrdfMIKpQDJDqkjte"><span
                                style="display: inline-flex; align-items: center;">​<svg width="10" height="10"
                                    viewBox="0 0 24 24" class="Zi Zi--TriangleDown" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M13.792 20.319c-.781 1.406-2.803 1.406-3.584 0L2.418 6.296c-.76-1.367.228-3.046 1.791-3.046h15.582c1.563 0 2.55 1.68 1.791 3.046l-7.79 14.023Z"
                                        clip-rule="evenodd"></path>
                                </svg></span></button></span><button type="button"
                        class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span
                            style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em"
                                viewBox="0 0 24 24" class="Zi Zi--Comment Button-zi t2ntD6J1DemdOdvh5FB4"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z"
                                    clip-rule="evenodd"></path>
                            </svg></span>67 条评论</button>
                    <div class="Popover ShareMenu ContentItem-action">
                        <div class="ShareMenu-toggler" id="Popover6-toggle" aria-haspopup="true" aria-expanded="false">
                            <button type="button"
                                class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span
                                    style="display: inline-flex; align-items: center;">​<svg width="1.2em"
                                        height="1.2em" viewBox="0 0 24 24"
                                        class="Zi Zi--Share Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor">
                                        <path
                                            d="M19.47 1.914a.8.8 0 0 1 1.204.778l-1.872 16.386a.9.9 0 0 1-1.204.743l-4.615-1.692a.7.7 0 0 0-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 0 1 .179-.504l5.808-7.148a.595.595 0 0 0-.897-.781l-5.93 6.354a1.1 1.1 0 0 1-1.258.252L2.57 13.46a.8.8 0 0 1-.08-1.415l16.98-10.13Z">
                                        </path>
                                    </svg></span>分享</button></div>
                    </div><button type="button"
                        class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span
                            style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em"
                                viewBox="0 0 24 24" class="Zi Zi--Star Button-zi t2ntD6J1DemdOdvh5FB4"
                                fill="currentColor">
                                <path
                                    d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 0 0 .165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 0 0-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 0 0-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 0 0-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 0 0 .164-.12l2.378-4.122Z">
                                </path>
                            </svg></span>收藏</button><button aria-live="polite" type="button"
                        class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span
                            style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em"
                                viewBox="0 0 24 24" class="Zi Zi--Heart Button-zi t2ntD6J1DemdOdvh5FB4"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M17.142 3.041c1.785.325 3.223 1.518 4.167 3.071 1.953 3.215.782 7.21-1.427 9.858a23.968 23.968 0 0 1-4.085 3.855c-.681.5-1.349.923-1.962 1.234-.597.303-1.203.532-1.748.587a.878.878 0 0 1-.15.002c-.545-.04-1.162-.276-1.762-.582a14.845 14.845 0 0 1-2.008-1.27 24.254 24.254 0 0 1-4.21-4.002c-2.1-2.56-3.16-6.347-1.394-9.463.92-1.624 2.362-2.892 4.173-3.266 1.657-.341 3.469.097 5.264 1.44 1.75-1.309 3.516-1.76 5.142-1.464Z"
                                    clip-rule="evenodd"></path>
                            </svg></span>喜欢</button>
                    <div class="Popover ContentItem-action"><button aria-label="更多" id="Popover7-toggle"
                            aria-haspopup="true" aria-expanded="false" type="button"
                            class="Button OptionsButton FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--iconOnly fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY hIwDV_tcL6XN1HprrnAq"><span
                                style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em"
                                    viewBox="0 0 24 24" class="Zi Zi--Dots Button-zi t2ntD6J1DemdOdvh5FB4"
                                    fill="currentColor">
                                    <path
                                        d="M6 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM10.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 12a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z">
                                    </path>
                                </svg></span></button></div><button data-zop-retract-question="true" type="button"
                        class="Button ContentItem-action ContentItem-rightButton FEfUrdfMIKpQDJDqkjte Button--plain fEPKGkUK5jyc4fUuT0QP"><span
                            class="RichContent-collapsedText">收起</span><span
                            style="display: inline-flex; align-items: center;">​<svg width="24" height="24"
                                viewBox="0 0 24 24" class="Zi Zi--ArrowDown ContentItem-arrowIcon is-active"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M17.776 10.517a.875.875 0 0 1-.248 1.212l-5.05 3.335a.875.875 0 0 1-.964 0L6.47 11.73a.875.875 0 1 1 .965-1.46l4.56 3.015 4.568-3.016a.875.875 0 0 1 1.212.248Z"
                                    clip-rule="evenodd"></path>
                            </svg></span></button>
                </div>
            </div>
            <div>
                <div>
                    <div class=""></div>
                    <div class="ModalLoading-content"><svg width="30" height="30" viewBox="0 0 66 66"
                            xmlns="http://www.w3.org/2000/svg" class="CircleLoadingBar  css-1od72gz" aria-hidden="true">
                            <g>
                                <circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33"
                                    r="30"></circle>
                            </g>
                        </svg></div>
                </div>
            </div>
        </div>
    </div>
</div>